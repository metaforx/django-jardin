{% extends 'unfold/layouts/base.html' %}

{% load i18n unfold %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
    Dashboard
{% endblock %}

{% block content %}
    {% component "unfold/components/container.html" %}
        {% component "unfold/components/flex.html" with class="gap-4"%}
            {% component "unfold/components/navigation.html" with items=navigation %}
            {% endcomponent %}

            {% component "unfold/components/navigation.html" with class="ml-auto" items=filters %}
            {% endcomponent %}
        {% endcomponent %}

        <!-- KPIs -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% for card in kpis %}
                {% trans "Last 7 days" as label %}
                {% component "unfold/components/card.html" with class="lg:w-1/3" %}
                    {% component "unfold/components/text.html" %}
                        {{ card.title }}
                    {% endcomponent %}

                    {% component "unfold/components/title.html" %}
                        {{ card.metric }}
                    {% endcomponent %}
                {% endcomponent %}
            {% endfor %}
        {% endcomponent %}

        <!-- Charts -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% component "unfold/components/card.html" %}
                {% component "unfold/components/title.html" with class="font-medium text-2xl text-gray-900 dark:text-gray-100" %}
                    Sensor Temperature Data
                {% endcomponent %}

                {% component "unfold/components/text.html" with class="text-gray-500 dark:text-gray-400 mb-8" %}
                    Latest measurements
                {% endcomponent %}

                <canvas id="sensorChart" style="max-height: 400px;"></canvas>
                <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
                <script>
                    const ctx = document.getElementById('sensorChart').getContext('2d');
                    const chartData = JSON.parse('{{ dauChartData|safe }}');
                    const chartOptions = JSON.parse('{{ chartOptions|safe }}');

                    new Chart(ctx, {
                        type: 'line',
                        data: chartData,
                        options: chartOptions
                    });
                </script>
            {% endcomponent %}
        {% endcomponent %}

        <!-- Table -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% component "unfold/components/card.html" with title="Recent Sensor Readings" %}
                {% component "unfold/components/table.html" with table=table card_included=1 striped=0 %}{% endcomponent %}
            {% endcomponent %}
        {% endcomponent %}

        
    {% endcomponent %}
{% endblock %}