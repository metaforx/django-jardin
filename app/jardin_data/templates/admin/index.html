{% extends 'unfold/layouts/base.html' %}

{% load i18n unfold %}

{% block breadcrumbs %}{% endblock %}

{% block title %}
    Dashboard
{% endblock %}

{% block content %}
    {% component "unfold/components/container.html" %}
        {% component "unfold/components/flex.html" with class="gap-4"%}
            {% component "unfold/components/navigation.html" with items=navigation %}
            {% endcomponent %}

            {% component "unfold/components/navigation.html" with class="ml-auto" items=filters %}
            {% endcomponent %}
        {% endcomponent %}

        <!-- KPIs -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% for card in kpis %}
                {% trans "Last 7 days" as label %}
                {% component "unfold/components/card.html" with class="lg:w-1/3" %}
                    {% component "unfold/components/text.html" %}
                        {{ card.title }}
                    {% endcomponent %}

                    {% component "unfold/components/title.html" %}
                        {{ card.metric }}
                    {% endcomponent %}
                {% endcomponent %}
            {% endfor %}
        {% endcomponent %}

        <!-- Charts -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% component "unfold/components/card.html" %}
                {% component "unfold/components/title.html" with class="font-medium text-2xl text-gray-900 dark:text-gray-100" %}
                    Sensor Temperature Data
                {% endcomponent %}

                {% component "unfold/components/text.html" with class="text-gray-500 dark:text-gray-400 mb-8" %}
                    Latest measurements
                {% endcomponent %}

                <canvas id="sensorChart" style="max-height: 400px;"></canvas>
                <script>
                    const ctx = document.getElementById('sensorChart').getContext('2d');
                    const chartData = JSON.parse('{{ dauChartData|safe }}');
                    const chartOptions = JSON.parse('{{ chartOptions|safe }}');

                    if (!chartOptions.plugins) {
                        chartOptions.plugins = {};
                    }
                    chartOptions.plugins.legend = {
                        display: false
                    };

                    // noinspection JSUnresolvedReference
                    new Chart(ctx, {
                        type: 'line',
                        data: chartData,
                        options: chartOptions
                    });
                </script>

            {% endcomponent %}
        {% endcomponent %}

        <!-- Temperature Extremes -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% if lowest_temp %}
                {% component "unfold/components/card.html" with class="lg:w-1/2" %}
                    {% component "unfold/components/text.html" with class="text-gray-500 dark:text-gray-400 mb-2" %}
                        Lowest Temperature (Last 7 Days)
                    {% endcomponent %}

                    {% component "unfold/components/title.html" with class="font-medium text-3xl mb-4" %}
                        {{ lowest_temp.value }}°C
                    {% endcomponent %}

                    {% component "unfold/components/flex.html" with class="gap-2 flex-col" %}
                        {% component "unfold/components/text.html" with class="text-sm" %}
                            <span style="color: {{ lowest_temp.color }}; font-weight: 600;">{{ lowest_temp.sensor_id }}</span> - {{ lowest_temp.sensor_name }}
                        {% endcomponent %}

                        {% component "unfold/components/text.html" with class="text-sm text-gray-500 dark:text-gray-400" %}
                            {{ lowest_temp.date }} at {{ lowest_temp.time }}
                        {% endcomponent %}
                    {% endcomponent %}
                {% endcomponent %}
            {% endif %}

            {% if highest_temp %}
                {% component "unfold/components/card.html" with class="lg:w-1/2" %}
                    {% component "unfold/components/text.html" with class="text-gray-500 dark:text-gray-400 mb-2" %}
                        Highest Temperature (Last 7 Days)
                    {% endcomponent %}

                    {% component "unfold/components/title.html" with class="font-medium text-3xl mb-4" %}
                        {{ highest_temp.value }}°C
                    {% endcomponent %}

                    {% component "unfold/components/flex.html" with class="gap-2 flex-col" %}
                        {% component "unfold/components/text.html" with class="text-sm" %}
                            <span style="color: {{ highest_temp.color }}; font-weight: 600;">{{ highest_temp.sensor_id }}</span> - {{ highest_temp.sensor_name }}
                        {% endcomponent %}

                        {% component "unfold/components/text.html" with class="text-sm text-gray-500 dark:text-gray-400" %}
                            {{ highest_temp.date }} at {{ highest_temp.time }}
                        {% endcomponent %}
                    {% endcomponent %}
                {% endcomponent %}
            {% endif %}
        {% endcomponent %}


        <!-- Table -->
        {% component "unfold/components/flex.html" with class="gap-8 mb-8 flex-col lg:flex-row" %}
            {% component "unfold/components/card.html" with title="Recent Sensor Readings" %}
                {% component "unfold/components/table.html" with table=table card_included=1 striped=0 %}{% endcomponent %}
            {% endcomponent %}
        {% endcomponent %}

        
    {% endcomponent %}
{% endblock %}